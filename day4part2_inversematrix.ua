P ← &fras "day4matrix.txt"

C ← (
  ¬⊞=.⇡⧻.
  ×ⁿ:¯1⇡⧻.♭↙1.⍉:
  ⊙:⍉↘1:
  ≡▽:¤
  ≡[∩□]
)

D ← ☇1∵(C°□)⊡0⍉

E ← ≡(×⊙(°□⊡1)/+♭°□⊡0.)

DET ← (|1
  ⍥(⊙(D.)).-1⧻⊡0_0.C
  ⍥(
    ⊙(⧻⊡0_0:↘1.⍉)E
    ⍉⊂≡(□☇1)↯⊂:[∘]⊙÷.⊙(⧻.):
  )
  /+E
)

ADJ ← (|1
  ↯△,≡□☇1⊞⊂.⇡⧻.
  ☇1:⧻.⊞⊂□:
  ≡(□⍉▽⊙(⍉▽)∩≠⊙:.⇡:⊙:⊡0:⊡1.⊙(⧻.)°□⊡1:°□⊡0.)
  ≡DET∵°□
  ⍉↯[.]:
  ∵⊂↯△,≡□☇1⊞⊂.⇡⧻.
  ≡(×ⁿ:¯1/+°□⊡0:°□⊡1.)☇1:⧻.
  ⍉↯[.]:
)

INV ← |1 ⊠÷:ADJ:DET.

⊜∘¬∊,"\n"P
≡(⊜⋕¬∊," ")
/+♭INV
